<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Botão Arrastável e Clicável (Mobile Otimizado)</title>
    <style>
        body {
            /* Impede o zoom e scroll padrão ao tocar */
            touch-action: none; 
            overflow: hidden; 
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }

        #botaoArrastavel {
            position: absolute;
            top: 50px;
            left: 50px;

            /* Estilo */
            padding: 20px 40px;
            background-color: #28a745; 
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);

            /* Propriedades de arrasto */
            cursor: grab; 
            user-select: none; 
            transition: box-shadow 0.1s; 
            text-align: center; 
            display: block; 
        }

        #botaoArrastavel:hover {
            opacity: 0.9;
        }

        #botaoArrastavel:active {
            cursor: grabbing;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>

    <div id="botaoArrastavel">Mova-me e Clique!</div>

    <script>
        const dragItem = document.getElementById('botaoArrastavel');

        // Variáveis de controle
        let active = false; // Indica se o arrasto está ativo
        let initialX_ptr;   // Posição X inicial do ponteiro
        let initialY_ptr;   // Posição Y inicial do ponteiro
        let isDragging = false; // Flag para indicar que houve um arrasto significativo
        let currentX;       
        let currentY;       
        let xOffset = 0;    
        let yOffset = 0;
        const CLICK_TOLERANCE = 5; // Limite de movimento em pixels

        // --- Configuração dos Eventos (Igual ao anterior) ---
        dragItem.addEventListener("mousedown", dragStart);
        dragItem.addEventListener("touchstart", dragStart);

        document.addEventListener("mousemove", drag);
        document.addEventListener("touchmove", drag);
        
        // **MUDANÇA AQUI:** A função dragEnd agora também lida com o clique.
        document.addEventListener("mouseup", dragEnd);
        document.addEventListener("touchend", dragEnd);

        // O evento 'click' no dragItem FOI REMOVIDO para evitar conflitos mobile.
        

        // --- Funções de Lógica ---

        function dragStart(e) {
            const isTouch = e.type.includes('touch');
            
            if (isTouch) {
                // Impede o zoom/scroll, mas cuidado para não impedir o evento de clique posterior
                // Para o arrasto, precisamos do preventDefault, mas o trataremos na função drag()
            }

            // A. Captura as posições iniciais do ponteiro (mouse ou dedo)
            initialX_ptr = isTouch ? e.touches[0].clientX : e.clientX;
            initialY_ptr = isTouch ? e.touches[0].clientY : e.clientY;

            // B. Calcula o offset de posicionamento do elemento
            const transform = window.getComputedStyle(dragItem).transform;
            let currentLeft, currentTop;

            if (transform && transform !== 'none') {
                const matrix = transform.match(/matrix.*\((.+)\)/)[1].split(', ');
                currentLeft = parseInt(matrix[4]) || 0;
                currentTop = parseInt(matrix[5]) || 0;
            } else {
                 currentLeft = dragItem.offsetLeft;
                 currentTop = dragItem.offsetTop;
            }

            // O offset é a diferença entre a posição do clique/toque e a posição atual do elemento
            xOffset = initialX_ptr - currentLeft;
            yOffset = initialY_ptr - currentTop;
            
            active = true;
            isDragging = false; // Assume que é um clique, a menos que haja movimento
        }

        function drag(e) {
            if (!active) return; // Só executa se o arrasto estiver ativo

            const isTouch = e.type.includes('touch');
            const clientX = isTouch ? e.touches[0].clientX : e.clientX;
            const clientY = isTouch ? e.touches[0].clientY : e.clientY;

            // C. Verifica se o movimento excedeu a tolerância para ser um arrasto
            const dx = Math.abs(clientX - initialX_ptr);
            const dy = Math.abs(clientY - initialY_ptr);

            if (dx > CLICK_TOLERANCE || dy > CLICK_TOLERANCE) {
                isDragging = true; // Se moveu mais que o limite, é um arrasto
            }

            // D. Previna o comportamento padrão *apenas se estivermos arrastando*
            if (isTouch && isDragging) {
                 e.preventDefault(); 
            }
            
            // E. Calcula e aplica a nova posição
            currentX = clientX - xOffset;
            currentY = clientY - yOffset;

            setTranslate(currentX, currentY, dragItem);
        }

        function dragEnd(e) {
            // F. Lógica do Clique: Verifica se o modo arrastar estava ativo e se não houve arrasto.
            if (active && !isDragging) {
                // Se o botão não foi arrastado, trate-o como um clique/toque.
                handleTap(); 
            }

            active = false; // Desativa o modo arrastar
            isDragging = false; // Reseta a flag
        }

        function setTranslate(xPos, yPos, el) {
            el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
        }

        // Nova função para lidar com o toque/clique
        function handleTap() {
            alert('Parabéns! Você Clicou/Tocou no botão Arrastável!');
            console.log('Botão clicado/tocado.');
        }

    </script>

</body>
</html>